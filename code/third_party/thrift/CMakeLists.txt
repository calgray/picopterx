# Thrift autogenerated interface code

# Find out where Thrift is
find_program (THRIFT_COMPILER thrift DOC "Thrift compiler executable")
if (NOT THRIFT_COMPILER)
	message (FATAL_ERROR "${Red}Thrift was not found. Please install it.${ColourReset}")
endif()

# Set the list of generated files
set (GENSOURCE
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-cpp/picopter_constants.h
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-cpp/picopter_constants.cpp
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-cpp/picopter_types.h
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-cpp/picopter_types.cpp
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-cpp/webInterface.h
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-cpp/webInterface.cpp
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-php/picopter/Types.php
	 ${CMAKE_CURRENT_BINARY_DIR}/gen-php/picopter/webInterface.php)

# Set the source files (thrift definition files)
set (SOURCE ${CMAKE_CURRENT_SOURCE_DIR}/picopter.thrift)

# Build the generated files
add_custom_command (OUTPUT ${GENSOURCE}
					COMMAND ${THRIFT_COMPILER} --gen cpp ${SOURCE}
					COMMAND ${THRIFT_COMPILER} --gen php ${SOURCE}
					DEPENDS ${SOURCE}
					COMMENT "Generating Thrift interface files...")

# Make it run when make is called					
add_custom_target(thriftgen ALL DEPENDS ${GENSOURCE})					
# Link in the generated header files
include_directories (${CMAKE_CURRENT_BINARY_DIR}/gen-cpp)